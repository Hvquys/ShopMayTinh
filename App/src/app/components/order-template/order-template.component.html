<div *ngIf="order" style="margin-bottom: 20px;overflow: auto;">
  <table class="table table-bordered">
    <tbody>
    <tr style="background: #f5f5f5;">
      <td colSpan="5">
        <div nz-row>
          <div nz-col nzSpan="8">
            <h3><strong>Mã đơn hàng: </strong> {{ order.id }}</h3>
          </div>
          <div nz-col nzSpan="8">
            <strong>Ngày đặt hàng: </strong> {{ order.created | date:'HH:mm dd-MM-yyyy' }}
          </div>
          <div nz-col nzSpan="8">
            <strong>Số điện thoại: </strong> {{ order.phoneNumber }}
          </div>
          <div nz-col nzSpan="24">
            <strong>Địa chỉ liên hệ: </strong> {{ order.address }}
          </div>
        </div>
      </td>
    </tr>
    <tr>
      <th colSpan="2">Tên sản phẩm</th>
      <th>Giá</th>
      <th>Số lượng</th>
      <th>Thành tiền</th>
    </tr>
    <tr *ngFor="let orderDetail of order.orderDetails">
      <td nzAlign="center">
        <img [src]="orderDetail.productImage | fullPathResource"
             style="width: 50px;border: 1px solid #dcdcdc;padding: 1px;min-width: 50px;" alt=""/>
      </td>
      <td>
        <div>
          {{ orderDetail.productName }}
        </div>
        <div *ngIf="orderDetail.attribute"
             style="border: 1px solid #dcdcdc;display: inline-block;padding: 2px 5px 2px 10px;margin: 5px 0 0;">
          <div [innerHTML]="orderDetail.attribute"></div>
        </div>
      </td>
      <td class="text-right">
        <b class="mg-r">
          <small>
            <s>
              {{ orderDetail.productPrice | number }} ₫
            </s>
          </small>
        </b>
        <b>
          {{ orderDetail.productDiscountPrice | number }} ₫
        </b>
      </td>
      <td nzAlign="center">
        {{ orderDetail.qty }}
      </td>
      <td class="text-right">
        <b>
          {{ (orderDetail.productDiscountPrice * orderDetail.qty) | number }} ₫
        </b>
        <div *ngIf="order.status == 40">
          <button (click)="review(orderDetail)" nz-button nzSize="small" nzType="primary">
            <ng-container
              *ngIf="(orderDetail.reviews && orderDetail.reviews.length > 0) || orderDetail.isReview; else elseTemplate">
              Xem lại đánh giá
            </ng-container>
            <ng-template #elseTemplate>
              Đánh giá
            </ng-template>
          </button>
        </div>
      </td>
    </tr>
    <tr>
      <td class="text-right" colspan="4">
        <h4>Tổng tiền</h4>
      </td>
      <td class="text-right">
        <h4 style="color:red">
          {{ getTotalAmount | number }} ₫
        </h4>
      </td>
    </tr>
    </tbody>
  </table>
</div>


<nz-modal (nzOnCancel)="isVisibleModal = !isVisibleModal" [(nzVisible)]="isVisibleModal" [nzFooter]="modalFooter" [nzStyle]="{ top: '20px' }"
          [nzWidth]="1000" nzTitle="Đánh giá sản phẩm">
  <ng-container *nzModalContent>
    <div *ngIf="orderDetailSelected && reviewModel" nz-row>
      <div nz-col nzSpan="24" style="overflow: auto;">
        <table class="table table-bordered">
          <tbody>
          <tr style="background: #5189B9;color: white;">
            <th colSpan="2">Tên sản phẩm</th>
            <th>Giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
          </tr>
          <tr>
            <td nzAlign="center">
              <img [src]="orderDetailSelected.productImage | fullPathResource"
                   style="width: 50px;border: 1px solid #dcdcdc;padding: 1px;min-width: 50px;" alt=""/>
            </td>
            <td>
              <div>
                {{ orderDetailSelected.productName }}
              </div>
              <div *ngIf="orderDetailSelected.attribute"
                   style="border: 1px solid #dcdcdc;display: inline-block;padding: 2px 5px 2px 10px;margin: 5px 0 0;">
                <div [innerHTML]="orderDetailSelected.attribute"></div>
              </div>
            </td>
            <td class="text-right">
              <b class="mg-r">
                <small>
                  <s>
                    {{ orderDetailSelected.productPrice | number }} ₫
                  </s>
                </small>
              </b>
              <b>
                {{ orderDetailSelected.productDiscountPrice | number }} ₫
              </b>
            </td>
            <td nzAlign="center">
              {{ orderDetailSelected.qty }}
            </td>
            <td class="text-right">
              <b>
                {{ (orderDetailSelected.productDiscountPrice * orderDetailSelected.qty) | number }} ₫
              </b>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <div nz-col nzSpan="24">
        <div style="margin: 20px 0;">
          <nz-rate [(ngModel)]="reviewModel.star" [nzTooltips]="tooltips"></nz-rate>
        </div>
        <div>
          <textarea [(ngModel)]="reviewModel.content" nz-input placeholder="Nội dung" rows="4"></textarea>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-template #modalFooter>
    <nz-form-item>
      <nz-form-control>
        <button (click)="isVisibleModal = !isVisibleModal" nz-button>Đóng</button>
        <button (click)="confirmReview()" nz-button nzType="primary">
          <ng-container
            *ngIf="(orderDetailSelected.reviews && orderDetailSelected.reviews.length > 0) || orderDetailSelected.isReview; else elseTemplate">
            Đánh giá lại
          </ng-container>
          <ng-template #elseTemplate>
            Đánh giá
          </ng-template>
        </button>
      </nz-form-control>
    </nz-form-item>
  </ng-template>
</nz-modal>
